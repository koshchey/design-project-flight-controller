\subsection{System Integration}

The firmware and hardware were co-designed to ensure seamless integration, with all peripherals and control structures mapped directly to hardware interfaces defined at the PCB design stage. The firmware architecture abstracts low-level hardware interaction through driver modules, allowing the stabilisation logic and control loops to operate independently of specific sensor or motor hardware as long as the communication interface remains consistent.

Integration consisted primarily of flashing the firmware onto the custom PCB and verifying that all I/O mappings aligned with the predefined pin assignments for motors, sensors, and communication interfaces. These pin mappings are fixed in hardware and therefore defined early in the design process to avoid later integration conflicts.

\textbf{Integration Scope}
\begin{itemize}
    \item Flight controller (ESP32) interfaced with IMU, ToF sensor, and motor drivers via I\textsuperscript{2}C, UART, and PWM.
    \item Power distribution validated across battery input, onboard regulators, and USB programming rail.
    \item Mechanical frame provides physical constraints for airflow, sensor line-of-sight, and connector accessibility.
    \item WebSocket communication used to validate telemetry and control signal flow during integration testing.
\end{itemize}

\begin{table}[H]
\centering
\renewcommand{\arraystretch}{1.2}
\begin{tabular}{|p{4cm}|p{9cm}|}
\hline
\rowcolor{gray!15}
\textbf{Subsystem} & \textbf{Integration Checkpoint} \\
\hline
Motor Control & PWM outputs verified against PCB pinout; each channel tested via serial command to confirm expected rotation. \\
\hline
Sensor Interfaces & IMU and ToF sensor initialisation confirmed over I\textsuperscript{2}C with valid data streaming into state estimator. \\
\hline
Power System & USB priority over battery verified; 3.3\,V rail checked under load during active sensor and Wi-Fi transmission. \\
\hline
Communication Link & WebSocket telemetry and setpoint commands validated \\
\hline
Mechanical Fit & PCB alignment, connector access, and sensor line-of-sight confirmed within frame tolerances. \\
\hline
\end{tabular}
\caption{System-Level Integration Verification Points}
\label{tab:system-integration}
\end{table}

\noindent All subsystems were integrated according to version-controlled interface definitions, and validated sequentially through subsystem and combined functional testing.

% Final system integration is shown in Fig.~\ref{fig:complete-drone}.

% \begin{figure}[H]
%     \centering
%     \includegraphics[width=0.7\textwidth]{img/frame-placeholder.png}
%     \caption{Completed Integrated Drone System \temp{placeholder}}
%     \label{fig:complete-drone}
% \end{figure}

% \temp{Add firmware figures mayhaps}
%-------------------------------------------------------------% 
\pagebreak
\include{2_body/design/stakeholder}

\pagebreak
\include{2_body/design/safety-ethical-risk}

\pagebreak

%-------------------------------------------------------------% 
\subsection{Process of Assembly}

\begin{table}[H]
\centering
\renewcommand{\arraystretch}{1.3}
\begin{tabular}{|p{4cm}|p{10cm}|}
\hline
\rowcolor{gray!15}
\textbf{Step} & \textbf{Action / Details} \\
\hline
\rowcolor{gray!5}
\multicolumn{2}{|c|}{\textbf{PCB Bring-Up}} \\
\hline
Unbox PCB & Inspect for solder mask defects, visual solder bridges, and damaged pads. \\
\hline
Continuity Test & 1) VBAT to GND (no short)  \newline 2) 3V3 to GND (no short)  \newline 3) Key nets per schematic. \\
\hline
ESD Protection & Use ESD mat and strap before populating components. \\
\hline
Populate Components & 1) 10 µF capacitor  \newline 2) 100 nF capacitor  \newline 3) ESP32 module  \newline 4) Female header pins: bent pins outwards for front sensor, vertical pins downward for bottom sensor. \\
\hline
Post-Solder Check & Perform continuity test on soldered components. \\
\hline
Voltage Rails & Verify 3V3 = 3.3 V. \\
\hline
Temperature Check & Ensure no component is abnormally hot at idle. \\
\hline
\rowcolor{gray!5}
\multicolumn{2}{|c|}{\textbf{3D-Printed Frame Assembly}} \\
\hline
Print Frame & 1) Material: PETG  \newline 2) Supports: tree  \newline 3) Infill: ~7\% gyroid  \newline 4) Wall thickness: 2 perimeters. \\
\hline
Post-Processing & 1) Remove supports and smooth edges; inspect for defects  \newline 2) Open front of frame for PCB insertion  \newline 3) Ensure no component contacts 3D printed surfaces; PCB sits flush  \newline 4) Slide motors into friction-fit holders. \\
\hline
Check Fit & 1) PCB flat  \newline 2) Connectors accessible  \newline 3) No compression on ESP32  \newline 4) Edges flush. \\
\hline
\rowcolor{gray!5}
\multicolumn{2}{|c|}{\textbf{Modular Options Assembly}} \\
\hline
Battery Cage & 1) Optionally insert under main frame. \\
\hline
Camera Module Holder & 1) Optionally attach on top of main frame. \\
\hline
Leg Pieces & 1) Insert into designated holes under main frame. \\
\hline
\rowcolor{gray!5}
\multicolumn{2}{|c|}{\textbf{Pre-Run Checks}} \\
\hline
Lead Routing & 1) Route motor/JST leads away from rotor sweep  \newline 2) Secure with tie-downs. \\
\hline
Clearance Check & 1) Ensure full clearance with guards  \newline 2) No wire chafe  \newline 3) Connectors latched  \newline 4) Motors held firmly. \\
\hline
Mechanical Tests & 1) Run shake or stability tests \textit{[location TBD]}. \\
\hline
Firmware Test & 1) Power on without propellers  \newline 2) Confirm ESP32 boots, sensors initialise  \newline 3) Each motor spins once  \newline 4) Verify serial output, \gls{led} states correct. \\
\hline
\end{tabular}
\caption{ESP Assembly and Pre-Run Procedure}
\label{tab:esp-assembly-numbered}
\end{table}

\textbf{Soldering Guide} \\
The following steps illustrate the initial PCB soldering process, showing component placement and orientation.

The soldering process for the ESP32 WROOM module is carried out in multiple steps to ensure proper electrical connections and component placement. In Step 1, the ESP32 WROOM is mounted onto the PCB along with the straight header pins and key components like resistors and capacitors. Step 2 involves soldering the bent header pins and high-current switches, ensuring all power and signal lines are correctly connected. Careful attention should be given to component orientation and alignment to avoid short circuits and ensure reliable operation. 

\begin{figure}[H]
    \centering
    \begin{subfigure}[b]{0.63\textwidth}
        \centering
        \includegraphics[width=\textwidth]{img/assembly-1.png}
        \caption{Step 1}
    \end{subfigure}
    \hfill
    \begin{subfigure}[b]{0.6\textwidth}
        \centering
        \includegraphics[width=\textwidth]{img/assembly-2.png}
        \caption{Step 2}
    \end{subfigure}
    \caption{ESP Soldering Steps}
\end{figure}

\pagebreak
\textbf{Main Frame} \\
This image shows the 3D-printed main frame of the drone, which provides structural support for the PCB, motors, and any modular components.

\begin{figure}[H]
    \centering
    \includegraphics[width=0.7\textwidth]{img/assembly-3.png}\
    \caption{Main Frame}
\end{figure}

% \pagebreak
\textbf{Frame Additions} \\
These figures illustrate optional components being inserted into the main frame, such as the camera holder and legs and can be removed, changed and altered easily to fit with the main frame.

% \begin{figure}[H]
%     \centering
%     \begin{subfigure}[b]{0.48\textwidth}
%         \centering
%         \includegraphics[width=\textwidth]{img/assembly-4.png}
%         \caption{Step 1}
%         \label{fig:assembly-4}
%     \end{subfigure}
%     \hfill
%     \begin{subfigure}[b]{0.48\textwidth}
%         \centering
%         \includegraphics[width=\textwidth]{img/assembly-5.png}
%         \caption{Step 2}
%         \label{fig:assembly-5}
%     \end{subfigure}
%     \caption{ESP Assembly Steps}
%     \label{fig:extras-assembly-steps}
% \end{figure}

\begin{figure}[H]
    \centering
    \begin{subfigure}[b]{0.4\textwidth}
        \centering
        \includegraphics[width=\textwidth]{img/assembly-4b.png}
        \caption{Camera Mount}
    \end{subfigure}
    \vspace{0.5cm}
    \begin{subfigure}[b]{0.45\textwidth}
        \centering
        \includegraphics[width=\textwidth]{img/assembly-9b.png}
        \caption{Battery Holder}
    \end{subfigure}
    \vspace{0.5cm} 
    \begin{subfigure}[b]{0.2\textwidth}
        \centering
        \includegraphics[width=\textwidth]{img/assembly-5b.png}
        \caption{Drone Foot}
    \end{subfigure}
    \caption{Frame Additions}
\end{figure}

% \begin{figure}[H]
%     \centering
%     \includegraphics[width=0.6\textwidth]{img/assembly-4.png}
% \end{figure}

% \begin{figure}[H]
%     \centering
%     \includegraphics[width=0.6\textwidth]{img/assembly-5.png}
% \end{figure}

% \begin{figure}[H]
%     \centering
%     \includegraphics[width=0.6\textwidth]{img/assembly-9.png}
% \end{figure}

\pagebreak
\textbf{Frame Assembly} \\
The following figures demonstrate how the additional frame components can be added to the main frame.

\begin{figure}[H]
    \centering
    \begin{subfigure}[b]{0.4\textwidth}
        \centering
        \includegraphics[width=\textwidth]{img/assembly-6.png}
        \caption{Camera Mount}
    \end{subfigure}
    % \vspace{0.5cm} 
    \begin{subfigure}[b]{0.35\textwidth}
        \centering
        \includegraphics[width=\textwidth]{img/assembly-7.png}
        \caption{Drone Foot}
    \end{subfigure}
    % \vspace{0.5cm}
    \begin{subfigure}[b]{0.35\textwidth}
        \centering
        \includegraphics[width=\textwidth]{img/assembly-8.png}
        \caption{Battery Holder}
    \end{subfigure}
    \caption{Frame Assembly Process}
\end{figure}

A summary of the additions is given below in Table~\ref{tab:frame-add-summary}.

\begin{table}[H]
\centering
\begin{tabular}{|p{3cm}|p{11cm}|}
\hline
\textbf{Module} & \textbf{Features} \\
\hline
Camera Module Snap-In &
o Customizable 3D-printed STL files for design adjustments \newline
o Lightweight and cost-effective \newline
o Perfect snap fit onto main frame \newline
o Easy PCB installation; bendable as needed \newline
o Provides access to ports/connectors \newline
o Back clearance for RST/BOOT buttons and status LEDs \newline
o Optional snap-on camera holder for modularity \\
\hline
3D-Printed Battery Holder & 
o Lightweight, customizable, affordable \newline
o Snap-fit onto main frame \newline
o Easy battery installation \newline
o Back clearance for downward-facing distance sensor \newline
o Supports modular quick insertion/removal \\
\hline
3D-Printed Legs / Drone Feet & 
o Cheap, lightweight, customizable \newline
o Optional inserts for flexible landing configuration \newline
o Sufficient leg length for sensor clearance \newline
o Four legs improve frame stability \\
\hline
\end{tabular}
\caption{Summary of Modular Frame Additions}
\label{tab:frame-add-summary}
\end{table}

%-------------------------------------------------------------% 
\pagebreak
\subsection{Design Outputs}

\textbf{Stored at:} \url{https://github.com/koshchey/design-project-flight-controller}.

\textbf{Repository Contents:}
\begin{itemize}
    \item \texttt{ELEC5552\_FinalReport\_Team04.pdf}: This report.
    \item \texttt{Final\_Report/}: Contains all \LaTeX{} source files.
    \item \texttt{Firmware/}: Flight controller firmware (\gls{esp-idf} project).
    \item \texttt{PCB Files/}: Gerber files, BOM, Pick and Place, schematic and layout for the current PCB design.
    \item \texttt{Frame/}: .stl files for 3D printed frame.
    \item \texttt{Prototypes/}: Any prototype designs and outputs.
    \item \texttt{V\&V/}: Validation \& Verification table, up to date.
\end{itemize}

%-------------------------------------------------------------% 
\pagebreak
\subsection{Final Cost}

To maintain a budget of over \$350 (R.23), and satisfy the usual assessor requirements (traceable BOM, evidence, margin, risks), mass production amortises one-off fees, lowering unit cost. Costs per unit are shown below depending on the production scale:

\begin{table}[H]
\centering
\begin{tabular}{l c}
\toprule
\textbf{Number of Drones Produced} & \textbf{Cost per Unit} \\
\midrule
1 unit   & \$75.15 \\
10 units & \$33.51 \\
100 units & \$29.34 \\
\bottomrule
\end{tabular}
\caption{Unit costs depending on production scale.}
\end{table}

\subsubsection{PCB Fabrication}

Fabrication \& Assembly is performed by JLCPCB (2-layer, top-side assembly only, 2.6mm thickness, green standard colour). Top-side mounting only reduces assembly fee and simplifies rework/inspection; PCB cost is therefore split into fabrication and loose parts. Shipping and handling cost \$18.

\begin{table}[H]
\centering
\begin{tabular}{l r}
\toprule
\textbf{Items} & \textbf{Price} \\
\midrule
Merchandise Total (5x PCB mounted: PCB, Components, Manual handling) & \$67.92 \\
Total (for 5 PCBs) & \$67.92 \\
Total (Per PCB) & \$13.58 \\
\bottomrule
\end{tabular}
\caption{PCB fabrication and assembly cost breakdown. Full BOM and Gerbers for top surface mount components are in the Appendix.}
\end{table}

\subsubsection{Additional Surface-Mounted Components}

Cost of recommended parts for one fully mounted PCB (LCSC supplier). Shipping and handling \$13.27 per purchase.

\begin{table}[H]
\centering
\begin{tabular}{l c r}
\toprule
\textbf{Item} & \textbf{Qty} & \textbf{Per Unit (\$)} \\
\midrule
ESP32 module (WROOM/compatible) & 1 & 4.33 \\
10 µF MLCC cut tape (100 pcs) & 1 & 0.0029 \\
100 nF MLCC cut tape (100 pcs) & 1 & 0.0024 \\
2.54 mm female headers (4 pin) & 2 sets & 2.86 \\
Solder wire & 1 & 0.50 \\
Toggle Switch – High current & 1 & 2.50 \\
Insulated Wire & 1 & 0.105 \\
\midrule
\textbf{Total (Per Drone)} & & 10.30 \\
\bottomrule
\end{tabular}
\caption{Cost breakdown of additional surface-mounted components.}
\end{table}

\pagebreak
\subsubsection{3D Printed Frame Cost}

Material: Entire frame printed in PETG with raft and tree supports (7\% gyroid infill). No shipping costs (local vendor in Perth). Cost includes filament used for supports. Printer usage is \$0.

\begin{table}[H]
\centering
\begin{tabular}{l c r}
\toprule
\textbf{Item} & \textbf{Qty} & \textbf{Per Unit (\$)} \\
\midrule
Filament & 70g & 1.40 \\
\bottomrule
\end{tabular}
\caption{3D printed frame material cost.}
\end{table}

\subsubsection{Motor and Battery Cost}

Batteries and motors/propellers are purchased commercially for safety and compliance. Average shipping \$15 per purchase.

\begin{table}[H]
\centering
\begin{tabular}{l c r}
\toprule
\textbf{Item} & \textbf{Qty} & \textbf{Per Unit (\$)} \\
\midrule
Battery 1S 800mAH & 1 & 4.89 \\
Motors + Propellers (1 set = 2x ACW, 2x CW) & 1 set & 5.59 \\
\gls{jst} male connectors / crimps & 4 & 0.103 \\
\bottomrule
\end{tabular}
\caption{Motor and battery cost breakdown. Recommended items and vendors listed in Appendix.}
\end{table}

\subsubsection{Total Price Breakdown for Manufacturing}

\begin{table}[H]
\centering
\begin{tabular}{l r}
\toprule
\textbf{Costs} & \textbf{Price Per Unit (\$)} \\
\midrule
PCB, top face assembled & 13.58 \\
Additional Components & 10.30 \\
3D Printed Frame & 1.40 \\
\midrule
\textbf{Total per Drone for Parts} & 28.88 \\
PCB Shipping Charge & 18.00 \\
Shipping and Handling (Components) & 13.27 \\
Shipping and Handling (Motors \& Battery) & 15.00 \\
\midrule
\textbf{Total Fees Per Production} & 46.27 \\
\bottomrule
\end{tabular}
\caption{Complete cost breakdown including parts and shipping/handling.}
\end{table}

